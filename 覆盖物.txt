绘制点、线、面
更新时间：2022年08月07日
简介
所有叠加或覆盖到地图的内容，我们统称为地图覆盖物。覆盖物拥有自己的地理坐标，当您拖动或缩放地图时，它们会相应的移动。

目前JSAPI GL版支持的覆盖物以基本图形为主。本节重点介绍一下如何向地图添加标注，以及与地图相关的一些交互。

DEMO详情

提供的覆盖物
可以使用map.addOverlay方法向地图添加覆盖物，使用map.removeOverlay方法移除覆盖物。

覆盖物	类名	说明
抽象基类	Overlay	所有的覆盖物均继承此类的方法
点	Marker	表示地图上的点，可自定义标注的图标
折线	Polyline	表示地图上的折线
多边形	Polygon	表示地图上的多边形
圆	Circle	表示地图上的圆
添加标注点
Marker是一个用来往地图上添加点标记的类。使用它将任何你希望用户看到的兴趣点标注在地图上。

API提供了默认图标样式，您也可以通过Icon类来指定自定义图标。Marker的构造函数的参数为Point和MarkerOptions（可选）。

注意：当您使用自定义图标时，标注的地理坐标点将位于标注所用图标的中心位置，您可通过Icon的offset属性修改标定位置。

1参考展示地图创建基本地图
2向地图中添加标注
如下示例，向地图中心点添加了一个标注，并使用默认的标注样式：
var point = new BMapGL.Point(116.404, 39.915);   
var marker = new BMapGL.Marker(point);        // 创建标注   
map.addOverlay(marker);                     // 将标注添加到地图中
3向地图中添加标注
定义标注图标 通过Icon类可实现自定义标注的图标，下面示例通过参数MarkerOptions的icon属性进行设置，您也可以使用marker.setIcon()方法。

var myIcon = new BMapGL.Icon("markers.png", new BMapGL.Size(23, 25), {   
    // 指定定位位置。  
    // 当标注显示在地图上时，其所指向的地理位置距离图标左上   
    // 角各偏移10像素和25像素。您可以看到在本例中该位置即是  
    // 图标中央下端的尖角位置。   
    anchor: new BMapGL.Size(10, 25),   
    // 设置图片偏移。  
    // 当您需要从一幅较大的图片中截取某部分作为标注图标时，您  
    // 需要指定大图的偏移位置，此做法与css sprites技术类似。   
    imageOffset: new BMapGL.Size(0, 0 - 25)   // 设置图片偏移   
});     
    // 创建标注对象并添加到地图  
var marker = new BMapGL.Marker(point, {icon: myIcon});   
map.addOverlay(marker); 
4监听标注事件
JSAPI支持监听覆盖物的事件。

marker.addEventListener("click", function(){   
    alert("您点击了标注");   
});
添加折线
Polyline表示地图上的折线覆盖物，它包含一组点，并将这些点连接起来形成折线。Polyline使用详情请见类参考
1添加折线
首先参考展示地图创建基本地图，之后添加折线覆盖物到地图中。折线覆盖物可以分别设置描边粗细、颜色、填充颜色等属性。
var polyline = new BMapGL.Polyline([
		new BMapGL.Point(116.399, 39.910),
		new BMapGL.Point(116.405, 39.920),
		new BMapGL.Point(116.425, 39.900)
	], {strokeColor:"blue", strokeWeight:2, strokeOpacity:0.5});
map.addOverlay(polyline);
添加多边形
Polygon表示地图上的多边形覆盖物，它包含一组点。多边形将这组点按顺序首尾相连，最终围成一个封闭图形。
1添加多边形
首先参考展示地图创建基本地图，之后添加多边形覆盖物到地图中。多边形覆盖物可以分别设置描边粗细、颜色、填充颜色等属性。
var polygon = new BMapGL.Polygon([
        new BMapGL.Point(116.387112,39.920977),
        new BMapGL.Point(116.385243,39.913063),
        new BMapGL.Point(116.394226,39.917988),
        new BMapGL.Point(116.401772,39.921364),
        new BMapGL.Point(116.41248,39.927893)
    ], {strokeColor:"blue", strokeWeight:2, strokeOpacity:0.5});
map.addOverlay(polygon);
覆盖物配置
1,线、面、圆覆盖物鼠标悬浮图标配置
function overlayCursor(val) {
if (val === 1) {
    map.setOverlayMoveCursor('url("https://cdn-app.nio.com/PE/2022/2/23/b7d13dfd-b564-4a94-a3ae-7a1e6741daab.svg") 40 53, crosshair');
} else {
    map.setOverlayMoveCursor('pointer');
}
}
2,点、线、面覆盖物添加geojson转换以及geojson更新数据
var _marker = new BMapGL.Marker(new BMapGL.Point(116.405, 39.920));
var _mGeojson = _marker.toGeoJSON();
console.log(_mGeojson);
_mGeojson.geometry.coordinates = [116.486409, 39.921489];
_marker.updateByGeoJSON(_mGeojson);
// 线、面类似操作
3,线、面、圆编辑节点可配置图标
var nodeT =  new BMapGL.Icon('http://maponline0.bdimg.com/sty/map_icons2x/MapRes/ditie_beijing_2.png', new BMapGL.Size(11, 11), {
offset: new BMapGL.Size(5, 5)
});
var node =  new BMapGL.Icon('http://maponline0.bdimg.com/sty/map_icons2x/MapRes/zhongheyiyuan.png', new BMapGL.Size(11, 11), {
offset: new BMapGL.Size(5, 5)
});
var polygon = new BMapGL.Polygon([
new BMapGL.Point(116.387112, 39.920977),
new BMapGL.Point(116.385243, 39.913063),
new BMapGL.Point(116.394226, 39.917988),
new BMapGL.Point(116.401772, 39.921364),
new BMapGL.Point(116.41248, 39.927893)
], {
node:node, // 线节点
nodeT:nodeT, // 线段中间节点
strokeStyle:'dashed',
strokeColor: 'blue',
strokeWeight: 8,
strokeOpacity: 0.8,
});


4,线、面、圆边可设置图片纹理
var polyline = new BMapGL.Polyline([
new BMapGL.Point(116.399, 39.910),
new BMapGL.Point(116.405, 39.920),
new BMapGL.Point(116.423493, 39.907445)
], {
strokeTexture: { // width/height 需要是2的n次方
url:'./images/Icon_road_blue_arrow.png',
width: 16,
height: 64
},
strokeWeight: 8,
strokeOpacity: 0.8
});
map.addOverlay(polyline);


-------------------------------------
带高度的点
更新时间：2020年10月22日
简介
基于 WebGL 点图元，百度地图 JSAPI GL 提供了 BMapGL.Marker3D 类进行带高度的点覆盖物绘制，支持对覆盖物点的高度、大小、形状、颜色及透明度的自定义，并可以进行纹理贴图以满足更多场景需求。

带高度的点
贴纹理
DEMO详情
Marker3D类参考
构造函数：

构造函数	说明
BMapGL.Marker3D(point, height, options)	Marker3D继承Overlay，用于创建带有高度的点，可以通过options自定义点的样式
参数说明：

构造函数	类型	说明
point	Point	点坐标，通过Point创建的点对象
height	number	点的高度
options	Object	点的自定义样式，可选
options属性变量：

options属性	类型	说明
size	number	点的大小，默认为50
shape	number	点的形状，1 为圆形，2 为正方形，默认为 1。也可以使用对应的常量 BMAP_SHAPE_CIRCLE 和 BMAP_SHAPE_RECT
fillColor	string	点的颜色，格式为 '#xxxxxx'，比如'#f00'
fillOpacity	number	点的透明度，范围0-1，默认0.8
icon	Icon	点的纹理贴图，格式为通过Icon创建的Icon对象
使用示例
1创建地图参照展示地图
2创建带高度的点，并添加到地图上
创建带高度的点使用BMapGL.Marker3D类，其继承自Overlay，通过map.addoverlay()方法将创建的点覆盖物添加到地图上。

    // 创建位置点
    var point = new BMapGL.Point(116.404, 39.915);
    // 创建带高度的点
    var marker3d = new BMapGL.Marker3D(point, 8000, {
        size: 50,
        shape: BMAP_SHAPE_CIRCLE,
        fillColor: '#454399',
        fillOpacity: 0.6
    });
    // 将点添加到地图上
    map.addOverlay(marker3d);
纹理贴图
1贴纹理
纹理图片首先需要通过Icon类创建实例，然后通过Marker3D类创建带高度的点实例时，将得到的Icon实例传给icon属性。
    // 创建位置点
    var pt = new BMapGL.Point(point.lng, point.lat);
    // 创建贴图纹理Icon
    var icon = new BMapGL.Icon(citys[i].img, new BMapGL.Size(40, 40));
    // 创建带高度的点，这里只需要size和icon
    var marker = new BMapGL.Marker3D(pt, 8000, {
        size: 80,
        icon: icon
    });
    // 将点添加到地图上
    map.addOverlay(marker);
---------------------------
镂空多边形绘制
更新时间：2020年10月22日
简介
镂空面绘制基于WebGL的模板取反处理，JSAPI GL提供的Polygon类提供镂空面绘制功能。
当个传入的两个区域路径，一个区域位于另一个区域内部，则这个区域不会被绘制出来，从而实现”洞“的效果。
DEMO详情

Polygon类参考
构造函数：

构造函数	说明
BMapGL.Polygon(points:Array< Point >, options)	创建多边形覆盖物
参数说明：

构造函数	类型	说明
points	Array< Point >	点坐标数组
options	Object	多边形样式自定义配置，可选
options属性变量：

options属性	类型	说明
strokeColor	string	边线颜色
fillColor	string	填充颜色。当参数为空时，折线覆盖物没有填充效果。
strokeWeight	number	边线宽度，以像素为单位
strokeOpacity	number	边线透明度，取值范围0-1
fillOpacity	number	填充透明度
strokeStyle	string	边线样式，solid或dashed
使用示例
1创建地图参照展示地图
2创建镂空多边形，并添加到地图上
镂空面绘制使BMapGL.Polygon类，第一个参数路径数组如果传入的是有相交的区域，则不绘制出来，实现“洞”的效果。
如下例顺义区轮廓线存在相交区域，则内部区域镂空处理。

    var bd = new BMapGL.Boundary();
    bd.get('顺义区', function (rs) {
        // console.log('外轮廓：', rs.boundaries[0])
        // console.log('内镂空：', rs.boundaries[1])
        var hole = new BMapGL.Polygon(rs.boundaries, {
            fillColor: 'blue',
            fillOpacity: 0.2
        });
        map.addOverlay(hole);
    });
-------------------------


3D棱柱
更新时间：2020年10月22日
简介
JSAPI GL提供的Prism类支持在地图上添加3D棱柱功能，继承Overlay类，可以基于位置经纬度，高度，顶面和侧面的颜色、透明度等属性来绘制不规则的棱柱体。
DEMO详情

Prism类参考
构造函数：

构造函数	说明
BMapGL.Prism(points, altitude, options)	创建3D棱柱覆盖物，构造函数里需要定义底面和高度。
参数说明：

构造函数	类型	说明
points	Array< Point >	底面坐标数组
altitude	number	高度
options	Object	棱柱样式自定义配置，可选
options属性变量：

options属性	类型	说明
topFillColor	string	顶面填充颜色
topFillOpacity	number	顶面填充颜色透明度，取值范围0-1
sideFillColor	string	侧面填充颜色
sideFillOpacity	number	侧面填充颜色透明度，取值范围0-1
enableMassClear	boolean	是否在调用map.clearOverlays清除此覆盖物，默认为true
使用示例
1创建地图参照展示地图
2创建棱柱，并添加到地图上
Prism继承Overlay，使用方法同其他覆盖物，首先通过Prism类创建棱柱实例，然后通过map.addOverlay()将其添加到地图上。

var prism = new BMapGL.Prism(path, 5000, {
    topFillColor: '#5679ea',
    topFillOpacity: 0.5,
    sideFillColor: '#5679ea',
    sideFillOpacity: 0.9
});
map.addOverlay(prism);
====================
地面叠加层覆盖物
更新时间：2020年12月14日
简介
JSAPI GL提供的GroundOverlay类支持在地图底面上叠加覆盖物，覆盖物可以是图片、自定义Canvas、视频。
GroundOverlay类继承Overlay类，基于Bounds确定在地面上的显示范围和大小，通过options来配置覆盖物的类型、源、透明度等。


图片叠加层
Canvas叠加层
视频叠加层
DEMO详情
GroundOverlay类参考
构造函数：

构造函数	说明
BMapGL.GroundOverlay(bounds, options)	GroundOverlay继承Overlay，用于添加地面叠加层覆盖物，通过options自定义叠加层的类型（图片、视频、canvas）等
参数说明：

构造函数	类型	说明
bounds	Bounds	叠加图层显示的矩形区域，通过Bounds类创建的对象
options	Object	叠加层样式配置，可选
options属性变量：

options属性	类型	说明
type	string	'video' | 'canvas'，默认为image
url	string	video url | 自定义的canvas对象
opacity	number	图层透明度，默认为1，范围0-1
图片类型示例
1创建地图参照展示地图
2创建地面叠加层实例，并添加到地图上
创建地面叠加层使用BMapGL.GroundOverlay类，其继承自Overlay，通过map.addoverlay()方法将创建的叠加层添加到地图上。
        // 创建叠加物显示的范围Bounds
        var pStart = new BMapGL.Point(117.19635, 36.24093);
        var pEnd = new BMapGL.Point(117.20350, 36.24764);
        var bounds = new BMapGL.Bounds(new BMapGL.Point(pStart.lng, pEnd.lat), 
                                       new BMapGL.Point(pEnd.lng, pStart.lat));
        // 创建地面叠加层实例
        var imgOverlay = new BMapGL.GroundOverlay(bounds, {
            type: 'image',
            url: '/jsdemo/img/shouhuimap.png',
            opacity: 1
        });
        // 叠加层添加到地图
        map.addOverlay(imgOverlay);
    
canvas类型叠加层
1
当叠加层纹理是canvas类型时，使用方法与图片类似，在options中设置其纹理源。
            // 自定义canvas
            function getTextureCanvas() {
                var textureCanvas = document.createElement('canvas');
                textureCanvas.width = textureCanvas.height = 200;
                var ctx = textureCanvas.getContext('2d');
                ctx.fillStyle = '#79a913';
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 6;
                ctx.lineCap = 'square';
                ctx.fillRect(0, 0, 200, 200);
                ctx.moveTo(50, 50);
                ctx.lineTo(150, 50);
                ctx.lineTo(150, 150);
                ctx.lineTo(50, 150);
                ctx.lineTo(50, 50);
                ctx.stroke();
                return textureCanvas;
            }
            
            // 添加canvas叠加层
            var canvasSource = getTextureCanvas();
            var pStart = new BMapGL.Point(116.447717, 39.919173);
            var pEnd = new BMapGL.Point(116.453125, 39.923475);
            var bounds = new BMapGL.Bounds(new BMapGL.Point(pStart.lng, pEnd.lat),
                                           new BMapGL.Point(pEnd.lng, pStart.lat));
            var canvasOverlay = new BMapGL.GroundOverlay(bounds, {
                type: 'canvas',
                url: canvasSource,
                opacity: 0.9
            });
            map.addOverlay(canvasOverlay);
    
video类型叠加层
1
当叠加层纹理是video类型时，使用方法与图片和canvas类似，在options中设置其纹理源。
            var pStart = new BMapGL.Point(94.582033, -7.989754);
            var pEnd = new BMapGL.Point(145.358572, 30.813867);
            var bounds = new BMapGL.Bounds(new BMapGL.Point(pStart.lng, pEnd.lat),
                                           new BMapGL.Point(pEnd.lng, pStart.lat));
            var imgOverlay = new BMapGL.GroundOverlay(bounds, {
                type: 'video',
                url: '/jsdemo/img/cloud.mov',
                opacity: 0.5
            });
            map.addOverlay(imgOverlay);
    ---------------------------------
文本标注
更新时间：2020年08月07日
简介
所有叠加或覆盖到地图的内容，我们统称为地图覆盖物。覆盖物拥有自己的地理坐标，当您拖动或缩放地图时，它们会相应的移动。

覆盖物主要分为：标注（点标注、折线、多边形、圆、文本标注）、信息窗口、图层。

本节重点介绍一下如何向地图添加文本标注，以及与地图相关的一些交互。

DEMO详情

提供的文本标注
Label：一个用来往地图上添加文本标注的类，您可以自定义标注的文本内容。

Label使用详情请见类参考

添加文本标注
API提供了默认的标注样式，您也可以通过setStyle来指定自定义样式。
1参考展示地图创建基本地图
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
    body, html,#allmap {width: 100%;height: 100%;overflow: hidden;margin:0;font-family:"微软雅黑";}
    </style>
    <script type="text/javascript" src="//api.map.baidu.com/api?type=webgl&v=1.0&ak=您的密钥"></script>
    <title>地图展示</title>
</head>
<body></body>
</html>
<script type="text/javascript">
    // GL版命名空间为BMapGL
    // 按住鼠标右键，修改倾斜角和角度
    var map = new BMapGL.Map("allmap");    // 创建Map实例
    map.centerAndZoom(new BMapGL.Point(116.404, 39.915), 11);  // 初始化地图,设置中心点坐标和地图级别
    map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放
</script>
2向地图中添加文本标注
如下示例，向地图添加了一个文本标注，并使用默认的标注样式：
var point = new BMapGL.Point(116.404, 39.915);
var content = "label";
var label = new BMapGL.Label(content, {       // 创建文本标注
    position: point,                          // 设置标注的地理位置
    offset: new BMapGL.Size(10, 20)           // 设置标注的偏移量
})  
map.addOverlay(label);                        // 将标注添加到地图中
3修改文本标注样式
通过setStyle类可实现自定义文本标注的样式，其参数为一个表示样式的JavaScript对象常量。

注意：如果css的属性名中包含连字符，需要将连字符去掉并将其后的字母进行大写处理，例如：背景色属性要写成：backgroundColor。

var point = new BMapGL.Point(116.404, 39.915);
var content = 'label';
var label = new BMapGL.Label(content, {       // 创建文本标注
    position: point,
    offset: new BMapGL.Size(10, 20)
})  
map.addOverlay(label);                        // 将标注添加到地图中
label.setStyle({                              // 设置label的样式
    color: '#000',
    fontSize: '30px',
    border: '2px solid #1E90FF'
})
4监听标注事件
JSAPI支持监听覆盖物的事件。
label.addEventListener("click", function(){  
    alert("您点击了标注");  
});
--------------------------------
信息窗口
更新时间：2020年08月07日
简介
所有叠加或覆盖到地图的内容，我们统称为地图覆盖物。覆盖物拥有自己的地理坐标，当您拖动或缩放地图时，它们会相应的移动。

覆盖物主要分为：标注（点标注、折线、多边形、圆、文本标注）、信息窗口、图层。

本节重点介绍一下如何向地图添加信息窗口，以及与地图相关的一些交互。

DEMO详情

提供的信息窗口
InfoWindow：信息窗口。也是一种特殊的覆盖物，它可以展示更为丰富的文字和多媒体信息。注意：同一时刻只能有一个信息窗口在地图上打开。

详情可见类参考。

添加信息窗口
信息窗口是地图上方浮动显示的HTML内容，可直接在地图上的任意位置打开，也可以在标注对象上打开（此时信息窗口的坐标与标注的坐标一致）。

1参考展示地图创建基本地图
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
    body, html,#allmap {width: 100%;height: 100%;overflow: hidden;margin:0;font-family:"微软雅黑";}
    </style>
    <script type="text/javascript" src="//api.map.baidu.com/api?type=webgl&v=1.0&ak=您的密钥"></script>
    <title>地图展示</title>
</head>
<body></body>
</html>
<script type="text/javascript">
    // GL版命名空间为BMapGL
    // 按住鼠标右键，修改倾斜角和角度
    var map = new BMapGL.Map("allmap");    // 创建Map实例
    map.centerAndZoom(new BMapGL.Point(116.404, 39.915), 11);  // 初始化地图,设置中心点坐标和地图级别
    map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放
</script>
2向地图中添加信息窗口
var opts = {
    width: 250,     // 信息窗口宽度
    height: 100,    // 信息窗口高度
    title: "Hello"  // 信息窗口标题
}
var infoWindow = new BMapGL.InfoWindow("World", opts);  // 创建信息窗口对象
map.openInfoWindow(infoWindow, map.getCenter());        // 打开信息窗口
------------------------------------------
自定义覆盖物
更新时间：2023年02月21日
简介
为了支持更丰富多彩的地图覆盖物类型，提供自定义覆盖物类 CustomOverlay，支持开发者自定义DOM覆盖物叠加到地图上，比如实现自定义的Canvas、SVG、DOM元素，常用于叠加自定义的表格、图片、文字、GIF动画、视频等
该自定义覆盖物一次只能创建一个覆盖物，如果想要批量创建同类型的覆盖物，可以移步自定义Html覆盖物图层类CustomHtmlLayer，支持根据GeoJSON格式数据进行批量自定义覆盖物叠加。

自定义canvas覆盖物
自定义DOM覆盖物
DEMO详情
类参考
（1）构造函数

名称	说明
CustomOverlay(createDom, options: Object)	创建单个自定义DOM覆盖物
参数说明：

参数名	类型	说明
createDom	HTMLElement	用户自定义创建DOM函数
options	point	Point	覆盖物的经纬度，必填
offsetX	Number	覆盖物水平偏移量
offsetY	Number	覆盖物垂直偏移量
MinZoom	Number	最小显示层级
MaxZoom	Number	最大显示层级
properties	Object	自绑定属性
enableMassClear	Boolean	是否能被统一清除掉覆盖物
enableDraggingMap	Boolean	是否可以在覆盖物位置拖拽地图
（2）方法

方法名	参数	返回值	说明
show()	none	none	显示自定义覆盖物
hide()	none	none	隐藏自定义覆盖物
setPoint	point	none	设置覆盖物新坐标
getPoint	none	point	获取自定义覆盖物坐标
setProperties	object	none	设置覆盖物属性，与初始化的属性增量修改或合并
getProperties	none	object	获取自定义覆盖物的属性
（3）事件
  通过addEventListener(event, callback)方法进行事件绑定，支持如下事件：  

事件名	说明
click	鼠标点击事件
mouseover	鼠标悬浮事件
mouseout	鼠标移出事件
图层示例
// 创建自定义覆盖物DOM
function createDOM(feature) {
    const img = document.createElement('img');
    img.style.height = '240px';
    img.style.width = '80px';
    img.src = 'https://bj.bcebos.com/v1/mapopen-pub-jsapigl/assets/images/fire.gif';
    img.draggable = false;
    return img;
}
  
// 创建自定义覆盖物
const customOverlay = new BMapGL.CustomOverlay(createDOM, {
    point: new BMapGL.Point(116.40342230333138, 39.92498414216742),
    opacity: 0.5,
    map: map,
    offsetY: -10,
    properties: {
        title: 'this is a title',
        size: '100'
    }
});
  
// 将自定义覆盖物添加到地图上
map.addOverlay(customOverlay);
  
// 绑定鼠标事件
customOverlay.addEventListener('click', function (e) {
    console.log('eeee', e);
});

